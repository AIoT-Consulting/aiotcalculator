<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title class="title">Month Page</title>
  <link rel="stylesheet" href="styles/style.css" />
  <link rel="icon" type="image/x-icon" href="https://aiot-consulting.github.io/Static-Assets/favicon.ico">
</head>
<body onload="loadVar(); calculate();">
  <h1>DMB ROI CALCULATOR </h1>
  <h2>Months vs Average Check Lift Scenario</h2>
<div class="tab">
  <button class="tab_off" id="tab1">Pricing / Ops Data</button>
  <button class="tab_on" id="tab2">Calculator (Month)</button>
  <button class="tab_off" id="tab3">Calculator (%&#8673)</button>
</div>
<h2>Store Operating Conditions</h2>

<!-- Testing Plus and Minus buttons for months selector -->
<div class="number-input">
  <button class="spinner decrement">-</button>
  <input type="number" id="test" name="Quantity[47]" value="36" class="qtyInputLoose" min="0" max="120">
  <button class="spinner increment">+</button>
</div>

<table class="tg">
<tr>
  <td class="item" colspan="2">MONTHS VS AVERAGE CHECK
      <input type="number" class="textbox" id="months" name="months" min="0" max="120" value="36"></td>
</tr>
<tr>
<td class="item" colspan="2">Use LifeSpan as Break Even
      <input type="checkbox" class="textbox" id="breakeven" name="breakeven"></td>
</tr>
</table>
<table class="tg">
<tr>
    <td>Annual Revenue:  </td>
    <td><span id="anrev"> ...</span></td>
  </tr>
  <tr>
    <td>Weekly transaction:  </td>
    <td><span id="weekly"> ...</span></td>
  </tr>
  <tr>
    <td>Monthly transaction:  </td>
    <td><span id="monthly"> ...</span></td>
  </tr>
  <tr>
    <td>Monthly Operating:  </td>
    <td><span id="opera"> ...</span></td>
  </tr>
  <tr>
    <td>CapEx & Labor:  </td>
    <td><span id="capex"> ...</span></td>
  </tr>
  <tr>
    <td>Average Check:  </td>
    <td><span id="avgchk"> ...</span></td>
  </tr>
  <tr>
    <td>Incremental $ Revenue (per trans):</td>
    <td><span id="checkD"> ...</span></td>
  </tr>
  <tr>
    <td>Incremental % Revenue (per trans):</td>
    <td><span id="checkP">...</span> </td>
  </tr>
  <tr>
    <td>Additional Monthly Sales Generated:</td>
    <td><span id="ad_mthsales">...</span> </td>
  </tr>
    <tr>
    <td>Additional Monthly Sales Profit:</td>
    <td id="amsp"><span id="mthsalesprofit">...</span> </td>
  </tr>
  <tr>
    <td>Mthly Profit minus Mthly Operating (Net Profit):</td>
    <td><span id="mthlyNet">...</span> </td>
  </tr>
  <tr>
    <td>Additional Profit Required:  </td>
    <td><span id="adprofit"> ...</span></td>
  </tr>
  <tr>
    <td>Additional Sales Required:  </td>
    <td><span id="adsales"> ...</span></td>
  </tr>


  <tr>
    <td><div>Profit Over <span id="period">...</span> Year Equipment Lifspan:  </div></td>
    <td><span id="profit">...</span> </td>
  </tr>
</table>
<script>

/** Testing Plus and Minus buttons for months selector **/
const input = document.querySelector('input[type=number]')
const increment = () => {
  input.value = Number(input.value) + 1
}
const decrement = () => {
  input.value = Number(input.value) - 1
}
document.querySelector('.spinner.increment').addEventListener('click', increment)
document.querySelector('.spinner.decrement').addEventListener('click', decrement)


/** Load a few required variables from localStorage **/
var avgcheck = parseFloat(localStorage.getItem('che_num') || 50);
var revenue = parseFloat(localStorage.getItem('rev_num') || 0);
var lifeSpan = parseFloat(localStorage.getItem('life_num') || 7);
var margin = parseFloat(localStorage.getItem('mar_num') || 50);
var saasCost = parseFloat(localStorage.getItem('saas_cost') || 0);
var suppCost = parseFloat(localStorage.getItem('supp_cost') || 0);
var creaCost = parseFloat(localStorage.getItem('crea_cost') || 0);
var pwrCost = parseFloat(localStorage.getItem('tot_power') || 0);
var hardware_tot = parseFloat(localStorage.getItem('hard_total') || 0);
var labor_tot = parseFloat(localStorage.getItem('labor_total') || 0);
var upfront_tot = hardware_tot + labor_tot;

function loadVar()  {
  months_num.value = localStorage.getItem('months_num') || 36;
  breakevenChecked = localStorage.getItem('brevchkbxmt') || true;
  const breakevenCheckbox = document.getElementById('breakeven');
  if(breakevenChecked === "false") {
    breakevenCheckbox.checked = false;}
  else {
    breakevenCheckbox.checked = true;}
  breakeven();
}

/** Listen for changing tab click **/
document.getElementById("tab1").addEventListener("click",() =>  {
    window.open("index.html", "_self");});
document.getElementById("tab3").addEventListener("click",() =>  {
    window.open("margin.html", "_self");});

/** Listen for changes in the input fields and update accordingly **/
let months_num = document.getElementById("months");
months.innerHTML = months_num.value;
months.onfocus = function() {
  months_num.select();
  localStorage.setItem('brevchkbxmt', false);
  const breakevenCheckbox = document.getElementById('breakeven');
  breakevenCheckbox.checked = false;
  }
months.oninput = function() {
  months.innerHTML = this.value;
  localStorage.setItem('months_num', months_num.value);
  calculate();}

/** Listen for lifespan breakeven checkbox and update accordingly **/
document.getElementById("breakeven").addEventListener("click",() =>  {
  const breakevenCheckbox = document.getElementById('breakeven');
  const isChecked = breakevenCheckbox.checked;
  breakevenChecked = localStorage.getItem('brevchkbxmt') || true;
  if(isChecked) {
    localStorage.setItem('brevchkbxmt', true);
    breakevenCheckbox.checked = true;}
  else {
    localStorage.setItem('brevchkbxmt', false);
    breakevenCheckbox.checked = false;
  }
  breakeven();});

/** Calculate total and display **/
function calculate()  {
const breakevenCheckbox = document.getElementById('breakeven');
const isChecked = breakevenCheckbox.checked;
let lifeSpan = localStorage.getItem('life_num') || 7;
let revenue = localStorage.getItem('rev_num') || 0;
let avgcheck = localStorage.getItem('che_num') || 50;
let weeklyTrans = (revenue / avgcheck) / 52;
let monthlyTrans = (revenue / avgcheck) / 12;
let annualTrans = (revenue / avgcheck); 
let totalTrans = monthlyTrans * (months.value);
let monthly_tot = (parseFloat(saasCost) + parseFloat(suppCost) + parseFloat(creaCost) + parseFloat(pwrCost));
let adSalesMth = ((parseFloat(months_num.value) * parseFloat(monthly_tot)) + upfront_tot) / (parseFloat(margin)/100);
localStorage.setItem('adSales_mth', adSalesMth);
let adprofit = ((parseFloat(months_num.value) * parseFloat(monthly_tot)) + upfront_tot);
let requiredLiftD =  adSalesMth/totalTrans;
if(requiredLiftD == Infinity || isNaN(requiredLiftD)){requiredLiftD = 0;}
let requiredLiftP =  requiredLiftD / parseFloat(avgcheck);
let profit = ((((requiredLiftD*((margin)/100))*annualTrans))*((lifeSpan-(months_num.value)/12)))-((monthly_tot)*(((lifeSpan*12)-months.value)));
/** Calculate additional monthly sales generated based on selected payback period (number of months) **/
let ad_mthsales = (monthlyTrans * requiredLiftD);
/** Calculate profit generated by additionnal monthly sales based on margin **/
let mthsalesprofit = ad_mthsales * (margin / 100);
/** Calculate Net profit generated by substracted monthly operating costs **/
let mthlyNet = mthsalesprofit - monthly_tot;
document.getElementById("opera").innerHTML = formatCurrencyLocal(parseFloat(monthly_tot).toFixed(2));
document.getElementById("capex").innerHTML = formatCurrencyLocal(parseFloat(hardware_tot).toFixed(2));
document.getElementById("avgchk").innerHTML = formatCurrencyLocal(parseFloat(avgcheck).toFixed(2));
document.getElementById("anrev").innerHTML = formatCurrencyLocal(parseFloat(revenue).toFixed(2));
document.getElementById("ad_mthsales").innerHTML = formatCurrencyLocal(parseFloat(ad_mthsales).toFixed(2));
document.getElementById("mthsalesprofit").innerHTML = formatCurrencyLocal(parseFloat(mthsalesprofit).toFixed(2));
document.getElementById("mthlyNet").innerHTML = formatCurrencyLocal(parseFloat(mthlyNet).toFixed(2));
document.getElementById("weekly").innerHTML = weeklyTrans.toFixed(0);
document.getElementById("monthly").innerHTML = monthlyTrans.toFixed(0);
document.getElementById("adprofit").innerHTML = formatCurrencyLocal(parseFloat(adprofit).toFixed(2));
document.getElementById("adsales").innerHTML = formatCurrencyLocal(parseFloat(adSalesMth).toFixed(2));
document.getElementById("checkD").innerHTML = '$ ' + parseFloat(requiredLiftD).toFixed(4);
document.getElementById("checkP").innerHTML = '% ' + ((requiredLiftP.toFixed(4)) * 100).toFixed(2);
document.getElementById('period').innerHTML = parseFloat(lifeSpan).toFixed(0);
document.getElementById("profit").innerHTML = formatCurrencyLocal(profit.toFixed(2));
}

// The formatCurrencyLocal function to convert value to currency with proper decimals and commas
function formatCurrencyLocal(num) {
    // Remove non-numeric characters from the input value
    let value = num.replace(/[^\d]+/g, '');
    // Split the value into whole and decimal parts
    const wholePart = value.slice(0, -2);
    const decimalPart = value.slice(-2);
    // Format the whole part with commas every three digits
    let formattedValue = wholePart.replace(/\B(?=(\d{3})+(?!\d))/g, ",");
    // Add the decimal point and the last two digits
    formattedValue += `.${decimalPart}`; 
    // Update the input value with the formatted value and add $ symbol
    num = "$"+formattedValue;
    return num;
}
/** Function to set months at the lifespan break even if checkbox is selected **/
function breakeven()  {
  let lifeSpan = localStorage.getItem('life_num') || 7;
  let currentMonth = document.getElementById("months");
  const breakevenCheckbox = document.getElementById('breakeven');
  const isChecked = breakevenCheckbox.checked;
  if(isChecked) {
    currentMonth.value = lifeSpan * 12;
  }
  else{
  currentMonth.value = localStorage.getItem('months_num') || 36;
  }
  calculate();
}
</script>
</body>
</html>

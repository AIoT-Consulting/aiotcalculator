<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title class="title">Month Page</title>
  <link rel="stylesheet" href="styles/style.css" />
  <link rel="icon" type="image/x-icon" href="https://aiot-consulting.github.io/Static-Assets/favicon.ico">
</head>
<body onload="loadVar(); calculate();">
  <h1>DMB ROI CALCULATOR </h1>
  <h2>Percent vs Months Scenario</h2>
<div class="tab">
  <button class="tab_off" id="tab1">Pricing / Ops Data</button>
  <button class="tab_off" id="tab2">Calculator (Months)</button>
  <button class="tab_on" id="tab3">Calculator (%&#8673)</button>
</div>
<h2>Store Operating Conditions</h2>
<table class="tg">
<tr>
  <td class="item" colspan="2">PERCENT INCREASE VS MONTHS:
  <button class="spinner decrement">-</button>
  <input type="number" class="QtyNum" id="increase" name="increase" min="0" max="100" step="0.01" value="1.2">
  <button class="spinner increment">+</button>
  </td>
</tr>
<tr>
<td class="item" colspan="2">Use LifeSpan as Break Even
      <input type="checkbox" class="textbox" id="breakeven" name="breakeven"></td>
</tr>
</table>
<table class="tg">
  <tr>
    <td>Annual Revenue:  </td>
    <td><span id="anrev"> ...</span></td>
  </tr>
  <tr>
    <td>Weekly transaction:  </td>
    <td><span id="weekly"> ...</span></td>
  </tr>
  <tr>
    <td>Monthly transaction:  </td>
    <td><span id="monthly"> ...</span></td>
  </tr>
  <tr>
    <td>Monthly Operating:  </td>
    <td><span id="opera"> ...</span></td>
  </tr>
  <tr>
    <td>CapEx & Labor:  </td>
    <td><span id="capex"> ...</span></td>
  </tr>
  <tr>
    <td>CapEx & Labor (Paided Back):  </td>
    <td><span id="capexpb"> ...</span></td>
  </tr>
    <tr>
    <td>Average Check:  </td>
    <td><span id="avgchk"> ...</span></td>
  </tr>
  <tr>
    <td>Incremental $ Revenue (per trans):</td>
    <td><span id="increv"> ...</span></td>
  </tr>
  <tr>
    <td>Additional Monthly Sales Generated:</td>
    <td><span id="ad_mthsales">...</span> </td>
  </tr>
  <tr>
    <td>Additional Monthly Sales Profit:</td>
    <td id="amsp"><span id="mthsalesprofit">...</span> </td>
  </tr>
  <tr>
    <td>Monthly Profit minus Monthly Operating (Net Profit):</td>
    <td><span id="mthlyNet">...</span> </td>
  </tr>
  <tr>
    <td>Additional Profit Required:  </td>
    <td><span id="adprofit"> ...</span></td>
  </tr>
  <tr>
    <td>Additional Sales Required:  </td>
    <td><span id="adsales"> ...</span></td>
  </tr>
  <tr>
    <td>Months Required to Break Even: </td>
    <td id="mth"><span id="mthreq"> ...</span></td>
 </tr>
  <tr>
    <td><div>Profit Over <span id="period">...</span> Year Equipment Lifspan:  </div></td>
    <td><span id="profit">...</span> </td>
  </tr>
</table>
<script>
/** Monitor the Plus and Minus buttons for the months selector **/
let increase_num = document.getElementById("increase");
increase.innerHTML = increase_num.value;
const increment = () => {
  localStorage.setItem('brevchkbxmt', false);
  const breakevenCheckbox = document.getElementById('breakeven');
  breakevenCheckbox.checked = false;
  increase_num.value = (Number(increase_num.value) + 0.01).toFixed(2);
  localStorage.setItem('increase_num', increase_num.value);
  calculate();
}
const decrement = () => {
  localStorage.setItem('brevchkbxmt', false);
  const breakevenCheckbox = document.getElementById('breakeven');
  breakevenCheckbox.checked = false;
  increase_num.value = (Number(increase_num.value) - 0.01).toFixed(2);
  if(increase_num.value < 0) {
    increase_num.value = (0).toFixed(2);}
  localStorage.setItem('increase_num', increase_num.value);
  calculate();
}
document.querySelector('.spinner.increment').addEventListener('click', increment)
document.querySelector('.spinner.decrement').addEventListener('click', decrement)
/** Load a few required variables from localStorage **/
var avgcheck = convertString(localStorage.getItem('che_num') || 15);
var revenue = convertString(localStorage.getItem('rev_num') || 100000);
var lifeSpan = parseFloat(localStorage.getItem('life_num') || 7);
var margin = parseFloat(localStorage.getItem('mar_num') || 50);
var saasCost = parseFloat(localStorage.getItem('saas_cost') || 0);
var suppCost = parseFloat(localStorage.getItem('supp_cost') || 0);
var creaCost = parseFloat(localStorage.getItem('crea_cost') || 0);
var pwrCost = parseFloat(localStorage.getItem('tot_power') || 0);
var hardware_tot = parseFloat(localStorage.getItem('hard_total') || 0);
var labor_tot = parseFloat(localStorage.getItem('labor_total') || 0);
var upfront_tot = hardware_tot + labor_tot;

function loadVar()  {
  increase_num.value = parseFloat(localStorage.getItem('increase_num') || 2.0).toFixed(2);
  breakevenChecked = localStorage.getItem('brevchkbxma') || true;
  const breakevenCheckbox = document.getElementById('breakeven');
  if(breakevenChecked === "false") {
    breakevenCheckbox.checked = false;}
  else {
    breakevenCheckbox.checked = true;}
  breakeven();
}
/** Listen for changing tab click **/
document.getElementById("tab1").addEventListener("click",() =>  {
    window.open("index.html", "_self");});
document.getElementById("tab2").addEventListener("click",() =>  {
    window.open("month.html", "_self");}); 
/** Listen for changes in the input fields and update accordingly **/
increase.innerHTML = increase_num.value;
increase.onfocus = function() {
  increase_num.select();
  localStorage.setItem('brevchkbxma', false);
  const breakevenCheckbox = document.getElementById('breakeven');
  breakevenCheckbox.checked = false;}
increase.oninput = function() {
  increase.innerHTML = this.value;
  localStorage.setItem('increase_num', increase_num.value);
  calculate();}
/** Listen for lifespan breakeven checkbox and update accordingly **/
document.getElementById("breakeven").addEventListener("click",() =>  {
  const breakevenCheckbox = document.getElementById('breakeven');
  const isChecked = breakevenCheckbox.checked;
  breakevenChecked = localStorage.getItem('brevchkbxma') || true;
  if(isChecked) {
    localStorage.setItem('brevchkbxma', true);
    breakevenCheckbox.checked = true;}
  else {
    localStorage.setItem('brevchkbxma', false);
    breakevenCheckbox.checked = false;
  }
    breakeven();
  });
function calculate()    {
  /** Calculate Calculate average transactions **/
  let weeklyTrans = (revenue / avgcheck) / 52;
  let monthlyTrans = (revenue / avgcheck) / 12;
  /** Calculate total monthly operating cost **/
  let monthly_tot = (saasCost + suppCost + creaCost + pwrCost);
  /** Calculate incremental revenue per transaction based on selected % increase in check size **/
  let increvenue = avgcheck *  (parseFloat(increase_num.value))/100;
  /** Calculate incremental revenue per month based on average monthly transactions **/
  let incre_month = (monthlyTrans * increvenue);
  /** Calculate additional profit generated per month after monthly operating costs are deducted **/
  let ad_mthsales = (monthlyTrans * increvenue);
  /** Calculate profit generated by additionnal monthly sales based on margin **/
  let mthsalesprofit = ad_mthsales * (margin / 100);
  /** Calculate Net profit generated by substracted monthly operating costs **/
  let mthlyNet = mthsalesprofit - monthly_tot;
  /** Months required to re-pay initial CapEx investment (Break Even) **/
  let months_req = upfront_tot / mthlyNet;
  /** Calculate additional sales required over period and store in locaStorage to make available on other tabs **/
  let adSalesMar = ad_mthsales * months_req;
  localStorage.setItem('adSales_mar', adSalesMar);
  /** Calculate Profit store will make after breakeven is reached **/
  let profit = ((months_req - (lifeSpan*12))) * mthlyNet;
  /** Calculate Months above lifespan **/
  let mthals = (lifeSpan*12) - months_req;
  let capex_pb = upfront_tot - Math.abs(mthlyNet * mthals);
  if (mthals >= 0)  {capex_pb = upfront_tot;}
  /** Calculate additional profit required **/
  let adprofit = ((months_req * parseFloat(monthly_tot)) + upfront_tot);
  /** Calculate additional sales required **/
  let adSalesMth = ((months_req * parseFloat(monthly_tot)) + upfront_tot) / (parseFloat(margin)/100);
  /** Display results on page **/
  document.getElementById("anrev").innerHTML = formatCurrencyLocal(revenue);
  document.getElementById("weekly").innerHTML = weeklyTrans.toFixed(0);
  document.getElementById("monthly").innerHTML = monthlyTrans.toFixed(0);
  document.getElementById("opera").innerHTML = formatCurrencyLocal(parseFloat(monthly_tot).toFixed(2));
  document.getElementById("capex").innerHTML = formatCurrencyLocal(upfront_tot.toFixed(2));
  if (mthlyNet > 0) {
    document.getElementById("capexpb").innerHTML = formatCurrencyLocal(parseFloat(capex_pb).toFixed(2));}
  else  {
    document.getElementById("capexpb").innerHTML = "$0.00";
  }
  document.getElementById("avgchk").innerHTML = formatCurrencyLocal(avgcheck);
  document.getElementById("increv").innerHTML = '$ ' + increvenue.toFixed(4);
  document.getElementById("ad_mthsales").innerHTML = formatCurrencyLocal(parseFloat(ad_mthsales).toFixed(2));
  document.getElementById("mthsalesprofit").innerHTML = formatCurrencyLocal(parseFloat(mthsalesprofit).toFixed(2));
  const amsp = document.getElementById("amsp");
  const tdmth = document.getElementById("mth");
  if (mthsalesprofit > monthly_tot) {
    amsp.style.backgroundColor = "green";}
  else{
    amsp.style.backgroundColor = "red";
  }
  if (months_req < 0 || months_req == Infinity ) {
    document.getElementById("mthlyNet").innerHTML = "$0.00";
    document.getElementById("mthreq").innerHTML = "IMPOSSIBLE";
    amsp.style.backgroundColor = "red";
    tdmth.style.backgroundColor = "red";}
  else  {
    document.getElementById("mthlyNet").innerHTML = formatCurrencyLocal(parseFloat(mthlyNet).toFixed(2));
    document.getElementById("mthreq").innerHTML = months_req.toFixed(2);
  }
  document.getElementById("adprofit").innerHTML = formatCurrencyLocal(adprofit.toFixed(2));
  document.getElementById("adsales").innerHTML = formatCurrencyLocal(adSalesMth.toFixed(2));
  document.getElementById("period").innerHTML = lifeSpan;
  if (mthals > 0 && mthlyNet > 0) {
    tdmth.style.backgroundColor = "green";}
  else{
    tdmth.style.backgroundColor = "red";
  }
  if (months_req < (lifeSpan*12)) {
    document.getElementById("profit").innerHTML = formatCurrencyLocal(parseFloat(profit).toFixed(2));}
  else  { 
    document.getElementById("profit").innerHTML = "$0.00";
  }
}
// The formatCurrencyLocal function to convert value to currency with proper decimals and commas
function formatCurrencyLocal(num) {
    // Remove non-numeric characters from the input value
    let value = num.replace(/[^\d]+/g, '');
    // Split the value into whole and decimal parts
    const wholePart = value.slice(0, -2);
    const decimalPart = value.slice(-2);
    // Format the whole part with commas every three digits
    let formattedValue = wholePart.replace(/\B(?=(\d{3})+(?!\d))/g, ",");
    // Add the decimal point and the last two digits
    formattedValue += `.${decimalPart}`; 
    // Update the input value with the formatted value and add $ symbol
    num = "$"+formattedValue;
    return num;
}
function convertString(stringNum) {
    // Remove non-numeric characters from the input value
    let value = stringNum.replace(/[^\d]+/g, '');
    // Split the value into whole and decimal parts
    const wholePart = value.slice(0, -2);
    const decimalPart = value.slice(-2);
    let formattedValue = wholePart.replace(/\B(?=(\d{3})+(?!\d))/g, ",");
    // Add the decimal point and the last two digits
    formattedValue = wholePart+`.${decimalPart}`;
    return formattedValue;
}
/** Function to set months at the lifespan break even if checkbox is selected **/
function breakeven()  {
  let monthly_tot = (saasCost + suppCost + creaCost + pwrCost);
  let monthlyTrans = (revenue / avgcheck) / 12;
  let increase_num = document.getElementById("increase");
  const breakevenCheckbox = document.getElementById('breakeven');
  const isChecked = breakevenCheckbox.checked;
  if(isChecked) {
    increase_num.value = (((((upfront_tot +  (lifeSpan * 12 * monthly_tot))/(monthlyTrans * lifeSpan * 12))/avgcheck))/(margin/10000)).toFixed(2);
  }
  else{
    increase_num.value = localStorage.getItem('increase_num') || 2.0;
  }
  calculate();
}
</script>
</body>
</html>

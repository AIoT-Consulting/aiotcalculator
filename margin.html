<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title class="title">Month Page</title>
  <link rel="stylesheet" href="styles/style.css" />
  <link rel="icon" type="image/x-icon" href="https://aiot-consulting.github.io/Static-Assets/favicon.ico">
</head>
<body onload="loadVar(); calculate();">
  <h1>DMB ROI CALCULATOR </h1>
  <h2>Percent vs Months Scenario</h2>
<div class="tab">
  <button class="tab_off" id="tab1">Pricing Data</button>
  <button class="tab_off" id="tab2">Calculator (Month)</button>
  <button class="tab_on" id="tab3">Calculator (%)</button>
</div>
<h2>Store Operating Conditions</h2>
<table class="tg">

<tr>
  <td class="item" rowspan="2">
      <legend for="increase">%  Increase in Check Size:</legend>
      <input type="number" class="textbox" id="increase" name="increase" min="0" max="100" step="0.01" value="1.2"></div> </td>
</tr>
</table>
<table class="tg">
  <tr>
    <td>Annual Revenue:  </td>
    <td><span id="anrev"> ...</span></td>
  </tr>
  <tr>
    <td>Weekly transaction:  </td>
    <td><span id="weekly"> ...</span></td>
  </tr>
  <tr>
    <td>Monthly transaction:  </td>
    <td><span id="monthly"> ...</span></td>
  </tr>
  <tr>
    <td>Monthly Operating:  </td>
    <td><span id="opera"> ...</span></td>
  </tr>
  <tr>
    <td>CapEx:  </td>
    <td><span id="capex"> ...</span></td>
  </tr>
  <tr>
    <td>CapEx (Paided Back):  </td>
    <td><span id="capexpb"> ...</span></td>
  </tr>
    <tr>
    <td>Average Check:  </td>
    <td><span id="avgchk"> ...</span></td>
  </tr>
  <tr>
    <td>Incremental $ Revenue (per trans):</td>
    <td><span id="increv"> ...</span></td>
  </tr>
  <tr>
    <td>Additional Monthly Sales Generated:</td>
    <td><span id="ad_mthsales">...</span> </td>
  </tr>
  <tr>
    <td>Additional Monthly Sales Profit:</td>
    <td id="amsp"><span id="mthsalesprofit">...</span> </td>
  </tr>
  <tr>
    <td>Monthly Profit minus Monthly Operating (Net Profit):</td>
    <td><span id="mthlyNet">...</span> </td>
  </tr>
  <tr>
    <td>Months Required to Break Even: </td>
    <td id="mth"><span id="mthreq"> ...</span></td>
 </tr>
  <tr>
    <td><div>Profit Store is MAKES Over<br><span id="period">...</span> Year Equipment Lifspan:  </div></td>
    <td><span id="profit">...</span> </td>
  </tr>
</table>
<script>

function loadVar()  {
  increase_num.value = localStorage.getItem('increase_num') || 36; 
}

/** Listen for changing tab click **/
document.getElementById("tab1").addEventListener("click",() =>  {
    window.open("index.html", "_self");});
document.getElementById("tab2").addEventListener("click",() =>  {
    window.open("month.html", "_self");}); 

/** Listen for changes in the input fields and update accordingly **/
let increase_num = document.getElementById("increase");
increase.innerHTML = increase_num.value;
increase.onfocus = function() {increase_num.select();}
increase.oninput = function() {
  increase.innerHTML = this.value;
  localStorage.setItem('increase_num', increase_num.value);
  calculate();}

function calculate()    {
  /** Load a few required variables from localStorage **/
  let avgcheck = localStorage.getItem('che_num') || 50;
  let revenue = localStorage.getItem('rev_num') || 0;
  let lifeSpan = localStorage.getItem('life_num') || 7;
  
  /** Calculate Calculate average transactions **/
  let weeklyTrans = (revenue / avgcheck) / 52;
  let monthlyTrans = (revenue / avgcheck) / 12;
  
  /** Calculate total monthly operating cost **/
  let saasCost = localStorage.getItem('saas_cost') || 0;
  let suppCost = localStorage.getItem('supp_cost') || 0;
  let creaCost = localStorage.getItem('crea_cost') || 0;
  let pwrCost = localStorage.getItem('tot_power') || 0;
  let monthly_tot = (parseFloat(saasCost) + parseFloat(suppCost) + parseFloat(creaCost) + parseFloat(pwrCost));
 
  /** Get CapEx value from localStorage **/
  let hardware_tot = localStorage.getItem('hard_total') || 0;
  
  /** Get margin value from localStorage **/
  let margin = localStorage.getItem('mar_num') || 50;
  
  /** Calculate incremental revenue per transaction based on selected % increase in check size **/
  let increvenue = parseFloat(avgcheck) *  (parseFloat(increase_num.value))/100;
  
  /** Calculate incremental revenue per month based on average monthly transactions **/
  let incre_month = (monthlyTrans * increvenue);
  
  /** Calculate additional profit generated per month after monthly operating costs are deducted **/
  let ad_mthsales = (monthlyTrans * increvenue);
  
  /** Calculate profit generated by additionnal monthly sales based on margin **/
  let mthsalesprofit = ad_mthsales * (margin / 100);

  /** Calculate Net profit generated by substracted monthly operating costs **/
  let mthlyNet = mthsalesprofit - monthly_tot;

  /** Months required to re-pay initial CapEx investment (Break Even) **/
  let months_req = hardware_tot / mthlyNet;
   
  /** Calculate additional sales required over period and store in locaStorage to make available on other tabs **/
  let adSalesMar = ad_mthsales * months_req;
  localStorage.setItem('adSales_mar', adSalesMar);

  /** Calculate Profit store will make after breakeven is reached **/
  

  let profit = ((months_req - (lifeSpan*12))) * mthlyNet;
  
  /** Calculate Months above lifespan **/
  let mthals = (lifeSpan*12) - months_req;
  let capex_pb = hardware_tot - Math.abs(mthlyNet * mthals);
  if (mthals >= 0)  {capex_pb = hardware_tot;}
  console.log(capex_pb);
  console.log(mthals);
  
  /** Display results on page **/
  document.getElementById("anrev").innerHTML = formatCurrencyLocal(parseFloat(revenue).toFixed(2));
  document.getElementById("weekly").innerHTML = weeklyTrans.toFixed(0);
  document.getElementById("monthly").innerHTML = monthlyTrans.toFixed(0);
  document.getElementById("opera").innerHTML = formatCurrencyLocal(parseFloat(monthly_tot).toFixed(2));
  document.getElementById("capex").innerHTML = formatCurrencyLocal(parseFloat(hardware_tot).toFixed(2));
  if (mthlyNet > 0) {
    document.getElementById("capexpb").innerHTML = formatCurrencyLocal(parseFloat(capex_pb).toFixed(2));}
  else  {
    {document.getElementById("capexpb").innerHTML = "$0.00";}
  }
  
  document.getElementById("avgchk").innerHTML = formatCurrencyLocal(parseFloat(avgcheck).toFixed(2));
  document.getElementById("increv").innerHTML = '$ ' + increvenue.toFixed(4);
  document.getElementById("ad_mthsales").innerHTML = formatCurrencyLocal(parseFloat(ad_mthsales).toFixed(2));
  document.getElementById("mthsalesprofit").innerHTML = formatCurrencyLocal(parseFloat(mthsalesprofit).toFixed(2));
  
  const amsp = document.getElementById("amsp");
  if (mthsalesprofit > monthly_tot) {
    amsp.style.backgroundColor = "green";}
  else{
    amsp.style.backgroundColor = "red";
  }
  if (months_req < 0 || months_req == Infinity ) {
    document.getElementById("mthlyNet").innerHTML = "$0.00";
    document.getElementById("mthreq").innerHTML = "IMPOSSIBLE";
    tdmth.style.backgroundColor = "red";}
  else  {
    document.getElementById("mthlyNet").innerHTML = formatCurrencyLocal(parseFloat(mthlyNet).toFixed(2));
    document.getElementById("mthreq").innerHTML = months_req.toFixed(2);
  }
  document.getElementById("period").innerHTML = lifeSpan;
  const tdmth = document.getElementById("mth");
  if (mthals > 0) {
    tdmth.style.backgroundColor = "green";}
  else{
    tdmth.style.backgroundColor = "red";
  }
  
  if (months_req < (lifeSpan*12)) {
    document.getElementById("profit").innerHTML = formatCurrencyLocal(parseFloat(profit).toFixed(2));}
  else  { 
    document.getElementById("profit").innerHTML = "$0.00";
  }
}
// The formatCurrencyLocal function to convert value to currency with proper decimals and commas
function formatCurrencyLocal(num) {
    // Remove non-numeric characters from the input value
    let value = num.replace(/[^\d]+/g, '');
    // Split the value into whole and decimal parts
    const wholePart = value.slice(0, -2);
    const decimalPart = value.slice(-2);
    // Format the whole part with commas every three digits
    let formattedValue = wholePart.replace(/\B(?=(\d{3})+(?!\d))/g, ",");
    // Add the decimal point and the last two digits
    formattedValue += `.${decimalPart}`; 
    // Update the input value with the formatted value and add $ symbol
    num = "$"+formattedValue;
    return num;
}
</script>
</body>
</html>
